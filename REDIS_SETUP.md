# üöÄ Redis Caching Setup Guide

## –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã API –≤ **20-40 —Ä–∞–∑** –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫!

### –§–∞–π–ª—ã:
- `webapp/backend/cache.py` - –º–æ–¥—É–ª—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- `webapp/backend/.env.example` - –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `webapp/backend/requirements.txt` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Redis

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Redis

### macOS (—á–µ—Ä–µ–∑ Homebrew):
```bash
brew install redis
brew services start redis
```

### Ubuntu/Debian:
```bash
sudo apt update
sudo apt install redis-server
sudo systemctl start redis
sudo systemctl enable redis
```

### Windows:
–°–∫–∞—á–∞—Ç—å Redis –¥–ª—è Windows: https://github.com/microsoftarchive/redis/releases

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WSL2 –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –Ω–∞ Linux.

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
cd webapp/backend
pip install -r requirements.txt
```

### 2. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª:
```bash
cp .env.example .env
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redis –≤ .env:
```env
# –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Redis (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis:
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
redis-cli ping
# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: PONG
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å backend:
```bash
cd webapp/backend
uvicorn main:app --reload
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫—ç—à —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç** (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
   - –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚ùå Cache MISS` –∏ `üíæ Cached project analytics`
   - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ~2-3 —Å–µ–∫—É–Ω–¥—ã

2. **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É** (–≤—Ç–æ—Ä–æ–π —Ä–∞–∑)
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `üéØ Cache HIT`
   - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ~0.05-0.1 —Å–µ–∫—É–Ω–¥—ã ‚ö°
   - **–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 20-40x!**

3. **–ù–∞–∂–∞—Ç—å "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"**
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `üßπ Invalidated cache for project {id}`
   - –ö—ç—à –æ—á–∏—â–∞–µ—Ç—Å—è, —Å–ª–µ–¥—É—é—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±—É–¥–µ—Ç —Å API

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis –≤—Ä—É—á–Ω—É—é:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Redis:
redis-cli

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∫–ª—é—á–∏:
KEYS *

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–ª—é—á–∏ –≤–∏–¥–∞:
# analytics:project:xxx
# analytics:user:123:project:xxx

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫—ç—à–∞:
GET "analytics:project:your_project_id"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å TTL (–≤—Ä–µ–º—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è):
TTL "analytics:project:your_project_id"

# –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à (–¥–ª—è —Ç–µ—Å—Ç–∞):
FLUSHDB
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ Redis (–±–µ–∑ –∫—ç—à–∞):
- –ö–∞–∂–¥–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: 2-5 —Å–µ–∫—É–Ω–¥
- –ü—Ä–∏ 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö: –º–µ–¥–ª–µ–Ω–Ω–æ
- –ü—Ä–∏ 50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö: –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ

### –ü–æ—Å–ª–µ Redis (—Å –∫—ç—à–µ–º):
- –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: 2-3 —Å–µ–∫—É–Ω–¥—ã (unchanged)
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏: 0.05-0.1 —Å–µ–∫—É–Ω–¥—ã ‚ö°
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 20-40x –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞—Ö–æ–¥–æ–≤!**
- –ü—Ä–∏ 100+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö: –±—ã—Å—Ç—Ä–æ ‚úÖ

## üõ†Ô∏è TTL (Time To Live) –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑:

- **–ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã**: 5 –º–∏–Ω—É—Ç
- **–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã**: 1 —á–∞—Å (–æ–Ω–∏ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è)
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**: 5 –º–∏–Ω—É—Ç

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–∂–Ω–æ –≤ `cache.py`:
```python
TTL_PROJECT_ANALYTICS = 300      # 5 –º–∏–Ω—É—Ç
TTL_FINISHED_PROJECT = 3600      # 1 —á–∞—Å
TTL_USER_ANALYTICS = 300         # 5 –º–∏–Ω—É—Ç
```

## üêõ Troubleshooting

### Redis –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è:

```
‚ö†Ô∏è Redis not available, caching disabled
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω: `redis-cli ping`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–µ—Ä–≤–æ–ª (–ø–æ—Ä—Ç 6379 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç)

### –ö—ç—à –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –≤—Ä—É—á–Ω—É—é:
redis-cli FLUSHDB
```

–ò–ª–∏ –≤ –∫–æ–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `cache.invalidate_project(project_id)` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è.

### –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ:

–ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ TTL. –ù–æ –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
```python
from cache import cache
cache.delete("analytics:project:*")  # –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫—ç—à–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
```

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] Redis —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω
- [ ] `pip install -r requirements.txt` –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] `.env` —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ Redis
- [ ] Backend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ `‚úÖ Redis connected: localhost:6379`
- [ ] –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ: `‚ùå Cache MISS`
- [ ] –ü—Ä–∏ –≤—Ç–æ—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–µ: `üéØ Cache HIT`
- [ ] –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–ª–∏—á–∏–ª–∞—Å—å –≤ 20+ —Ä–∞–∑!

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Render

–î–ª—è production –¥–æ–±–∞–≤–∏—Ç—å –≤ Render Environment Variables:

```env
REDIS_HOST=your-redis-host.redis.com
REDIS_PORT=6379
REDIS_PASSWORD=your-redis-password
REDIS_DB=0
```

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- **Redis Cloud** (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier 30MB): https://redis.com/try-free/
- **Upstash Redis** (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier 10K –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å): https://upstash.com/
- **Render Redis** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –≤–∞—à–µ–º –ø–ª–∞–Ω–µ)

---

**–ì–æ—Ç–æ–≤–æ! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 20-40 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!** üöÄ
